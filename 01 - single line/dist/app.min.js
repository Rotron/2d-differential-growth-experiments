"use strict";function _slicedToArray(e,i){return _arrayWithHoles(e)||_iterableToArrayLimit(e,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,i){var t=[],n=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(n=(r=a.next()).done)&&(t.push(r.value),!i||t.length!==i);n=!0);}catch(e){o=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw s}}return t}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,i,t){return i&&_defineProperties(e.prototype,i),t&&_defineProperties(e,t),e}var path,Node=function(){function s(e,i,t,n){var o=4<arguments.length&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,s),this.position=e,this.nextPosition=e,this.minDistance=i,this.maxDistance=t,this.repulsionRadius=n,this.isFixed=o}return _createClass(s,[{key:"iterate",value:function(){this.nextPosition.x=constrain(this.nextPosition.x,PADDING,window.innerWidth-PADDING),this.nextPosition.y=constrain(this.nextPosition.y,PADDING,window.innerHeight-PADDING),this.position=p5.Vector.lerp(this.position,this.nextPosition,VELOCITY)}},{key:"draw",value:function(){this.isFixed?fill(255,0,0):fill(0),this.isFixed?ellipse(this.position.x,this.position.y,10):ellipse(this.position.x,this.position.y,5)}}]),s}(),Path=function(){function t(e){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,t),this.nodes=e,this.closed=i}return _createClass(t,[{key:"isClosed",value:function(){this.closed=!0}},{key:"isOpen",value:function(){this.closed=!1}},{key:"iterate",value:function(){var e=!0,i=!1,t=void 0;try{for(var n,o=this.nodes.entries()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var s=_slicedToArray(n.value,2),r=s[0],a=s[1];this.applyAttraction(r),this.applyRepulsion(r),this.applyAlignment(r),a.iterate()}}catch(e){i=!0,t=e}finally{try{e||null==o.return||o.return()}finally{if(i)throw t}}this.splitEdges()}},{key:"applyAttraction",value:function(e){var i=this.getConnectedNodes(e);null!=i.nextNode&&i.nextNode instanceof Node&&!this.nodes[e].isFixed&&min(this.nodes[e].minDistance,i.nextNode.minDistance)<this.nodes[e].position.dist(i.nextNode.position)&&(this.nodes[e].nextPosition=p5.Vector.lerp(this.nodes[e].position,i.nextNode.position,ATTRACTION_FORCE)),null!=i.previousNode&&i.previousNode instanceof Node&&!this.nodes[e].isFixed&&min(this.nodes[e].minDistance,i.previousNode.minDistance)<this.nodes[e].position.dist(i.previousNode.position)&&(this.nodes[e].nextPosition=p5.Vector.lerp(this.nodes[e].position,i.previousNode.position,ATTRACTION_FORCE))}},{key:"applyRepulsion",value:function(e){var i=!0,t=!1,n=void 0;try{for(var o,s=this.nodes.entries()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var r=_slicedToArray(o.value,2),a=r[0],d=r[1];if(e!=a){var l=min(this.nodes[e].repulsionRadius,d.repulsionRadius);this.nodes[e].position.dist(d.position)<=l&&!this.nodes[e].isFixed&&(this.nodes[e].nextPosition=p5.Vector.lerp(this.nodes[e].position,d.position,-REPULSION_FORCE))}}}catch(e){t=!0,n=e}finally{try{i||null==s.return||s.return()}finally{if(t)throw n}}}},{key:"applyAlignment",value:function(e){var i=this.getConnectedNodes(e);if(null!=i.previousNode&&i.previousNode instanceof Node&&null!=i.nextNode&&i.nextNode instanceof Node&&!this.nodes[e].isFixed){var t=p5.Vector.lerp(i.previousNode.position,i.nextNode.position,.5);this.nodes[e].nextPosition=p5.Vector.lerp(t,this.nodes[e].nextPosition,ALIGNMENT_FORCE)}}},{key:"splitEdges",value:function(){var e=!0,i=!1,t=void 0;try{for(var n,o=this.nodes.entries()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var s=_slicedToArray(n.value,2),r=s[0];s[1];if(r<this.nodes.length-1){var a=min(this.nodes[r].maxDistance,this.nodes[r+1].maxDistance);if(this.nodes[r].position.dist(this.nodes[r+1].position)>a&&this.nodes.length<MAX_NODES){var d=new Node(p5.Vector.lerp(this.nodes[r].position,this.nodes[r+1].position,.5),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS);this.nodes.splice(r+1,0,d)}}}}catch(e){i=!0,t=e}finally{try{e||null==o.return||o.return()}finally{if(i)throw t}}}},{key:"injectNode",value:function(){var e=parseInt(random(this.nodes.length-60,this.nodes.length-5)),i=this.getConnectedNodes(e);if(null!=i.previousNode&&i.previousNode instanceof Node&&null!=i.nextNode&&i.nextNode instanceof Node&&1<i.previousNode.position.dist(i.nextNode.position)){var t=new Node(p5.Vector.lerp(i.previousNode.position,i.nextNode.position,.5).add(createVector(random(1,5),random(1,5))),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS);this.nodes.splice(e,0,t)}}},{key:"getConnectedNodes",value:function(e){var i,t;return 0<e-1?i=this.nodes[e-1]:this.isClosed&&(i=this.nodes[this.nodes.length]),e+1<this.nodes.length?t=this.nodes[e+1]:this.isClosed&&(t=this.nodes[0]),{previousNode:i,nextNode:t}}},{key:"draw",value:function(){stroke(0,0,0,255);for(var e=0;e<this.nodes.length-1;e++)line(this.nodes[e].position.x,this.nodes[e].position.y,this.nodes[e+1].position.x,this.nodes[e+1].position.y);this.closed&&line(this.nodes[this.nodes.length-1].position.x,this.nodes[this.nodes.length-1].position.y,this.nodes[0].position.x,this.nodes[0].position.y),fill(0),noStroke();var i=!0,t=!1,n=void 0;try{for(var o,s=this.nodes[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)o.value}catch(e){t=!0,n=e}finally{try{i||null==s.return||s.return()}finally{if(t)throw n}}}}]),t}(),MIN_DISTANCE=10,MAX_DISTANCE=30,REPULSION_RADIUS=60,NODE_INJECT_INTERVAL=100,MAX_NODES=500,VELOCITY=.2,ATTRACTION_FORCE=1,REPULSION_FORCE=1,ALIGNMENT_FORCE=.2,PADDING=0,lastNodeInjectTime=0;function setup(){createCanvas(window.innerWidth,window.innerHeight);var e=[new Node(createVector(0,window.innerHeight/2),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS,!0),new Node(createVector(window.innerWidth,window.innerHeight/2),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS,!0)];path=new Path(e)}function draw(){background(250),path.iterate(),path.draw(),millis()-lastNodeInjectTime>=NODE_INJECT_INTERVAL&&path.nodes.length<MAX_NODES&&(path.injectNode(),lastNodeInjectTime=millis())}