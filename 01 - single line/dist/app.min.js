"use strict";function _slicedToArray(i,t){return _arrayWithHoles(i)||_iterableToArrayLimit(i,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(i,t){var e=[],n=!0,s=!1,o=void 0;try{for(var r,a=i[Symbol.iterator]();!(n=(r=a.next()).done)&&(e.push(r.value),!t||e.length!==t);n=!0);}catch(i){s=!0,o=i}finally{try{n||null==a.return||a.return()}finally{if(s)throw o}}return e}function _arrayWithHoles(i){if(Array.isArray(i))return i}function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}function _createClass(i,t,e){return t&&_defineProperties(i.prototype,t),e&&_defineProperties(i,e),i}var path,Node=function(){function o(i,t,e,n){var s=4<arguments.length&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,o),this.position=i,this.nextPosition=i,this.minDistance=t,this.maxDistance=e,this.repulsionRadius=n,this.isFixed=s}return _createClass(o,[{key:"iterate",value:function(){this.nextPosition.x=constrain(this.nextPosition.x,PADDING,window.innerWidth-PADDING),this.nextPosition.y=constrain(this.nextPosition.y,PADDING,window.innerHeight-PADDING),this.position=p5.Vector.lerp(this.position,this.nextPosition,VELOCITY)}},{key:"draw",value:function(){this.isFixed?fill(0,255,0):fill(0),ellipse(this.position.x,this.position.y,5)}}]),o}(),Path=function(){function e(i){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,e),this.nodes=i,this.closed=t}return _createClass(e,[{key:"isClosed",value:function(){this.closed=!0}},{key:"isOpen",value:function(){this.closed=!1}},{key:"iterate",value:function(){var i=!0,t=!1,e=void 0;try{for(var n,s=this.nodes.entries()[Symbol.iterator]();!(i=(n=s.next()).done);i=!0){var o=_slicedToArray(n.value,2),r=o[0],a=o[1];this.applyAttraction(r),this.applyAlignment(r),a.iterate()}}catch(i){t=!0,e=i}finally{try{i||null==s.return||s.return()}finally{if(t)throw e}}this.splitEdges()}},{key:"applyAttraction",value:function(i){0<i-1&&min(this.nodes[i-1].minDistance,this.nodes[i].minDistance)<this.nodes[i].position.dist(this.nodes[i-1].position)&&!this.nodes[i].isFixed&&(this.nodes[i].nextPosition=p5.Vector.lerp(this.nodes[i].position,this.nodes[i-1].position,ATTRACTION_FORCE)),i+1<this.nodes.length&&min(this.nodes[i].minDistance,this.nodes[i+1].minDistance)<this.nodes[i].position.dist(this.nodes[i+1].position)&&!this.nodes[i].isFixed&&(this.nodes[i].nextPosition=p5.Vector.lerp(this.nodes[i].position,this.nodes[i+1].position,ATTRACTION_FORCE))}},{key:"applyRepulsion",value:function(i){var t=!0,e=!1,n=void 0;try{for(var s,o=this.nodes[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var r=s.value,a=min(this.nodes[i].repulsionRadius,r.repulsionRadius);this.nodes[i].position.dist(r.position)<=a&&this.nodes[i].isFixed}}catch(i){e=!0,n=i}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}}},{key:"applyAlignment",value:function(i){var t,e;if(0<i-1?t=this.nodes[i-1]:0==i&&this.isClosed&&(t=this.nodes[this.nodes.length]),i+1<this.nodes.length?e=this.nodes[i+1]:i==this.nodes.length&&this.isClosed&&(e=this.nodes[0]),null!=t&&t instanceof Node&&null!=e&&e instanceof Node){var n=p5.Vector.lerp(t.position,e.position,.5);this.nodes[i].nextPosition=p5.Vector.lerp(n,this.nodes[i].position,ALIGNMENT_FORCE)}}},{key:"splitEdges",value:function(){var i=!0,t=!1,e=void 0;try{for(var n,s=this.nodes.entries()[Symbol.iterator]();!(i=(n=s.next()).done);i=!0){var o=_slicedToArray(n.value,2),r=o[0];o[1];if(r+1<this.nodes.length){var a=min(this.nodes[r].maxDistance,this.nodes[r+1].maxDistance);if(this.nodes[r].position.dist(this.nodes[r+1].position)>a&&this.nodes.length<MAX_NODES){var l=new Node(p5.Vector.lerp(this.nodes[r].position,this.nodes[r+1].position,.5),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS);this.nodes.splice(r+1,0,l)}}}}catch(i){t=!0,e=i}finally{try{i||null==s.return||s.return()}finally{if(t)throw e}}}},{key:"injectNode",value:function(){var i=parseInt(random(0,this.nodes.length)),t=i+1;if(i!=this.nodes.length-1||this.closed){i==this.nodes.length-1&&this.closed&&(t=0);var e=new Node(p5.Vector.lerp(this.nodes[i].position,this.nodes[t].position,.5).add(createVector(0,random(5,100))),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS);this.nodes.splice(i,0,e)}}},{key:"draw",value:function(){fill(0),noStroke();var i=!0,t=!1,e=void 0;try{for(var n,s=this.nodes[Symbol.iterator]();!(i=(n=s.next()).done);i=!0){n.value.draw()}}catch(i){t=!0,e=i}finally{try{i||null==s.return||s.return()}finally{if(t)throw e}}stroke(0);for(var o=0;o<this.nodes.length-1;o++)line(this.nodes[o].position.x,this.nodes[o].position.y,this.nodes[o+1].position.x,this.nodes[o+1].position.y);this.closed&&line(this.nodes[this.nodes.length-1].position.x,this.nodes[this.nodes.length-1].position.y,this.nodes[0].position.x,this.nodes[0].position.y)}}]),e}(),MIN_DISTANCE=100,MAX_DISTANCE=200,REPULSION_RADIUS=100,NODE_INJECT_INTERVAL=100,MAX_NODES=50,VELOCITY=.1,ATTRACTION_FORCE=1.25,REPULSION_FORCE=.001,ALIGNMENT_FORCE=.1,PADDING=100,lastNodeInjectTime=0;function setup(){createCanvas(window.innerWidth,window.innerHeight);var i=[new Node(createVector(window.innerWidth/5,window.innerHeight/2),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS,!0),new Node(createVector(4*window.innerWidth/5,window.innerHeight/2),MIN_DISTANCE,MAX_DISTANCE,REPULSION_RADIUS,!0)];path=new Path(i)}function draw(){background(250),path.iterate(),path.draw(),millis()-lastNodeInjectTime>=NODE_INJECT_INTERVAL&&path.nodes.length<MAX_NODES&&(path.injectNode(),lastNodeInjectTime=millis())}