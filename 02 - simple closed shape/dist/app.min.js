"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){var i=[],n=!0,s=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);n=!0);}catch(t){s=!0,o=t}finally{try{n||null==a.return||a.return()}finally{if(s)throw o}}return i}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}!function o(r,a,h){function l(e,t){if(!a[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var s=a[e]={exports:{}};r[e][0].call(s.exports,function(t){return l(r[e][1][t]||t)},s,s.exports,o,r,a,h)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<h.length;t++)l(h[t]);return l}({1:[function(t,e,i){e.exports={SeedRadius:100,MinDistance:1,MaxDistance:5,RepulsionRadius:10,MaxVelocity:.1,AttractionForce:.2,RepulsionForce:.6,AlignmentForce:.55,ScreenPadding:20,MaxNodes:1e4,NodeInjectionInterval:100,DrawNodes:!1,TraceMode:!1,InvertedColors:!1,DebugMode:!0,FillMode:!1,BrownianMotionRange:.01}},{}],2:[function(t,e,i){var n,l=t("../../core/Node"),s=t("../../core/Path"),o=t("../../core/World"),u=t("./Settings"),r=2;new p5(function(h){function e(t,e){for(var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=[],s=0;s<t;s++){var o=2*Math.PI*s/t+h.radians(i),r=Math.floor(e*Math.cos(o)),a=Math.floor(e*Math.sin(o));n.push(new l(h,window.innerWidth/2+r,window.innerHeight/2+a,!1,u))}return n}function t(t){switch(r=t,n.clearPaths(),t){case 0:n.addPath(new s(h,e(3,u.SeedRadius,30),!0,u));break;case 1:n.addPath(new s(h,e(4,u.SeedRadius,45),!0,u));break;case 2:n.addPath(new s(h,e(60,u.SeedRadius),!0,u))}n.drawBackground(),n.draw(),n.pause(),setTimeout(function(){n.unpause()},1e3)}h.setup=function(){h.createCanvas(window.innerWidth,window.innerHeight),h.colorMode(h.HSB,255),n=new o(h,void 0,u),t(r)},h.draw=function(){n.iterate(),n.draw()},h.keyReleased=function(){switch(h.key){case"1":t(0);break;case"2":t(1);break;case"3":t(2);break;case"t":n.toggleTraceMode();break;case"n":n.setDrawNodes(!n.getDrawNodes());break;case"r":t(r);break;case" ":n.paused=!n.paused;break;case"i":n.toggleInvertedColors(),n.drawBackground();break;case"d":n.toggleDebugMode();break;case"f":n.toggleFillMode()}}})},{"../../core/Node":4,"../../core/Path":5,"../../core/World":6,"./Settings":1}],3:[function(t,e,i){e.exports={MinDistance:20,MaxDistance:30,RepulsionRadius:20,MaxVelocity:.1,Acceleration:.1,AttractionForce:.001,RepulsionForce:500,AlignmentForce:.001,ScreenPadding:20,MaxNodes:3e3,NodeInjectionInterval:100,DrawNodes:!1,TraceMode:!1}},{}],4:[function(t,e,i){var a=t("./node_modules/vec2"),h=t("./Defaults"),n=function(t){function r(t,e,i){var n,s=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:h;return _classCallCheck(this,r),(n=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,e,i))).p5=t,n.isFixed=s,n.settings=o,n.velocity=0,n.nextPosition=new a(e,i),n}return _inherits(r,a),_createClass(r,[{key:"iterate",value:function(){this.isFixed||(this.x=this.p5.lerp(this.x,this.nextPosition.x,this.settings.MaxVelocity),this.y=this.p5.lerp(this.y,this.nextPosition.y,this.settings.MaxVelocity))}},{key:"draw",value:function(){this.isFixed?this.p5.ellipse(this.x,this.y,20):this.p5.ellipse(this.x,this.y,5)}}]),r}();e.exports=n},{"./Defaults":3,"./node_modules/vec2":11}],5:[function(t,e,i){var o=t("./node_modules/rbush"),h=t("./node_modules/rbush-knn"),u=(t("./node_modules/vec2"),t("./Node")),r=t("./Defaults"),n=function(){function s(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:r;_classCallCheck(this,s),this.p5=t,this.nodes=e,this.isClosed=i,this.settings=n,this.tree=o(9,[".x",".y",".x",".y"]),this.buildTree(),this.injectionMode="RANDOM",this.lastNodeInjectTime=0,this.drawNodes=this.settings.DrawNodes,this.invertedColors=this.settings.InvertedColors,this.traceMode=this.settings.TraceMode,this.debugMode=this.settings.DebugMode,this.fillMode=this.settings.FillMode}return _createClass(s,[{key:"iterate",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,s=this.nodes.entries()[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=_slicedToArray(n.value,2),r=o[0],a=o[1];this.applyAttraction(r),this.applyRepulsion(r),this.applyAlignment(r),this.avoidWalls(r),a.iterate()}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}this.splitEdges(),this.pruneNodes(),this.p5.millis()-this.lastNodeInjectTime>=this.settings.NodeInjectionInterval&&this.nodes.length<this.settings.MaxNodes&&(this.injectNode(),this.lastNodeInjectTime=this.p5.millis()),this.buildTree()}},{key:"applyBrownianMotion",value:function(t){this.nodes[t].x+=this.p5.random(-this.settings.BrownianMotionRange/2,this.settings.BrownianMotionRange/2),this.nodes[t].y+=this.p5.random(-this.settings.BrownianMotionRange/2,this.settings.BrownianMotionRange/2)}},{key:"applyAttraction",value:function(t){var e=this.getConnectedNodes(t);null!=e.nextNode&&e.nextNode instanceof u&&!this.nodes[t].isFixed&&this.nodes[t].distance(e.nextNode)>this.settings.MinDistance&&(this.nodes[t].nextPosition.x=this.p5.lerp(this.nodes[t].nextPosition.x,e.nextNode.x,this.settings.AttractionForce),this.nodes[t].nextPosition.y=this.p5.lerp(this.nodes[t].nextPosition.y,e.nextNode.y,this.settings.AttractionForce)),null!=e.previousNode&&e.previousNode instanceof u&&!this.nodes[t].isFixed&&this.nodes[t].distance(e.previousNode)>this.settings.MinDistance&&(this.nodes[t].nextPosition.x=this.p5.lerp(this.nodes[t].nextPosition.x,e.previousNode.x,this.settings.AttractionForce),this.nodes[t].nextPosition.y=this.p5.lerp(this.nodes[t].nextPosition.y,e.previousNode.y,this.settings.AttractionForce))}},{key:"applyRepulsion",value:function(t){var e=h(this.tree,this.nodes[t].x,this.nodes[t].y,void 0,void 0,this.settings.RepulsionRadius*this.settings.RepulsionRadius),i=!0,n=!1,s=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var a=o.value;this.nodes[t].nextPosition.x=this.p5.lerp(this.nodes[t].x,a.x,-this.settings.RepulsionForce),this.nodes[t].nextPosition.y=this.p5.lerp(this.nodes[t].y,a.y,-this.settings.RepulsionForce)}}catch(t){n=!0,s=t}finally{try{i||null==r.return||r.return()}finally{if(n)throw s}}}},{key:"applyAlignment",value:function(t){var e=this.getConnectedNodes(t);if(null!=e.previousNode&&e.previousNode instanceof u&&null!=e.nextNode&&e.nextNode instanceof u&&!this.nodes[t].isFixed){var i=this.getMidpointNode(e.previousNode,e.nextNode);this.nodes[t].nextPosition.x=this.p5.lerp(this.nodes[t].nextPosition.x,i.x,this.settings.AlignmentForce),this.nodes[t].nextPosition.y=this.p5.lerp(this.nodes[t].nextPosition.y,i.y,this.settings.AlignmentForce)}}},{key:"splitEdges",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,s=this.nodes.entries()[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=_slicedToArray(n.value,2),r=o[0],a=o[1],h=this.getConnectedNodes(r);if(null!=h.previousNode&&h.previousNode instanceof u&&a.distance(h.previousNode)>=this.settings.MaxDistance&&this.nodes.length<this.settings.MaxNodes){var l=this.getMidpointNode(a,h.previousNode);0==r?this.nodes.splice(this.nodes.length,0,l):this.nodes.splice(r,0,l)}}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}}},{key:"pruneNodes",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,s=this.nodes.entries()[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=_slicedToArray(n.value,2),r=o[0],a=o[1],h=this.getConnectedNodes(r);null!=h.previousNode&&h.previousNode instanceof u&&a.distance(h.previousNode)<this.settings.MinDistance&&(0==r?this.nodes[this.nodes.length-1].isFixed||this.nodes.splice(this.nodes.length-1,1):this.nodes[r-1].isFixed||this.nodes.splice(r-1,1))}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}}},{key:"injectNode",value:function(){switch(this.injectionMode){case"RANDOM":this.injectRandomNode();break;case"CURVATURE":this.injectNodeByCurvature()}}},{key:"injectRandomNode",value:function(){var t=parseInt(this.p5.random(1,this.nodes.length)),e=this.getConnectedNodes(t);if(null!=e.previousNode&&e.previousNode instanceof u&&null!=e.nextNode&&e.nextNode instanceof u&&this.nodes[t].distance(e.previousNode)>this.settings.MinDistance){var i=this.getMidpointNode(this.nodes[t],e.previousNode);this.nodes.splice(t,0,i)}}},{key:"injectNodeByCurvature",value:function(){console.log("test");var t=!0,e=!1,i=void 0;try{for(var n,s=this.nodes.entries()[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=_slicedToArray(n.value,2),r=o[0],a=o[1],h=this.getConnectedNodes(r),l=a.distance(h.previousNode),u=a.distance(h.nextNode);if(180*Math.atan(l/u)/Math.PI<30){console.log(r);var d=this.getMidpointNode(a,h.previousNode),c=this.getMidpointNode(a,h.nextNode);console.log(d),console.log(c),this.p5.noLoop(),0==r?(this.nodes.splice(this.nodes.length-1,0,d),this.nodes.splice(0,1,c)):this.nodes.splice(r,1,d,c)}}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}}},{key:"avoidWalls",value:function(t){this.nodes[t].x=this.p5.constrain(this.nodes[t].x,0,window.innerWidth),this.nodes[t].y=this.p5.constrain(this.nodes[t].y,0,window.innerHeight)}},{key:"getConnectedNodes",value:function(t){var e,i;return 0==t&&this.isClosed?e=this.nodes[this.nodes.length-1]:1<=t&&(e=this.nodes[t-1]),t==this.nodes.length-1&&this.isClosed?i=this.nodes[0]:t<=this.nodes.length-1&&(i=this.nodes[t+1]),{previousNode:e,nextNode:i}}},{key:"getMidpointNode",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return new u(this.p5,(t.x+e.x)/2,(t.y+e.y)/2,i,this.settings)}},{key:"buildTree",value:function(){this.tree.clear(),this.tree.load(this.nodes)}},{key:"draw",value:function(){this.fillMode?this.traceMode?this.invertedColors?this.p5.fill(255,1):this.p5.fill(0,1):this.invertedColors?this.p5.fill(255):this.p5.fill(0):this.p5.noFill(),this.traceMode?this.invertedColors?this.p5.stroke(255,2):this.p5.stroke(0,2):this.invertedColors?this.p5.stroke(255):this.p5.stroke(0),this.debugMode||this.p5.beginShape();for(var t=0;t<this.nodes.length;t++)this.debugMode?0<t&&(this.traceMode?this.p5.stroke(this.p5.map(t,0,this.nodes.length-1,0,255,!0),255,255,2):this.p5.stroke(this.p5.map(t,0,this.nodes.length-1,0,255,!0),255,255,255),this.p5.line(this.nodes[t-1].x,this.nodes[t-1].y,this.nodes[t].x,this.nodes[t].y)):this.p5.vertex(this.nodes[t].x,this.nodes[t].y);if(this.isClosed&&(this.debugMode?this.p5.line(this.nodes[this.nodes.length-1].x,this.nodes[this.nodes.length-1].y,this.nodes[0].x,this.nodes[0].y):this.p5.vertex(this.nodes[0].x,this.nodes[0].y)),this.debugMode||this.p5.endShape(),this.drawNodes){this.p5.noStroke(),this.invertedColors?this.p5.fill(255):this.p5.fill(0);var e=!0,i=!1,n=void 0;try{for(var s,o=this.nodes.entries()[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var r=_slicedToArray(s.value,2),a=r[0],h=r[1];this.debugMode&&this.p5.fill(this.p5.map(a,0,this.nodes.length-1,0,255,!0),255,255,255),h.draw()}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}}}]),s}();e.exports=n},{"./Defaults":3,"./Node":4,"./node_modules/rbush":9,"./node_modules/rbush-knn":8,"./node_modules/vec2":11}],6:[function(t,e,i){var s=t("./Defaults"),n=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:s;_classCallCheck(this,n),this.p5=t,this.paths=e,this.paused=!1,this.settings=i,this.traceMode=this.settings.TraceMode,this.drawNodes=this.settings.DrawNodes,this.debugMode=this.settings.DebugMode,this.invertedColors=this.settings.InvertedColors,this.fillMode=this.settings.FillMode}return _createClass(n,[{key:"iterate",value:function(){if(null!=this.paths&&this.paths instanceof Array&&0<this.paths.length&&!this.paused){var t=!0,e=!1,i=void 0;try{for(var n,s=this.paths[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){n.value.iterate()}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}}}},{key:"draw",value:function(){if(!this.paused){this.traceMode||this.drawBackground();var t=!0,e=!1,i=void 0;try{for(var n,s=this.paths[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){n.value.draw()}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}}}},{key:"drawBackground",value:function(){this.invertedColors?this.p5.background(0):this.p5.background(255)}},{key:"addPath",value:function(t){t.drawNodes=this.drawNodes,t.traceMode=this.traceMode,t.debugMode=this.debugMode,t.invertedColors=this.invertedColors,t.fillMode=this.fillMode,this.paths.push(t)}},{key:"clearPaths",value:function(){this.paths=[]}},{key:"pause",value:function(){this.paused=!0}},{key:"unpause",value:function(){this.paused=!1}},{key:"getDrawNodes",value:function(){return this.drawNodes}},{key:"getTraceMode",value:function(){return this.traceMode}},{key:"getInvertedColors",value:function(){return this.invertedColors}},{key:"getDebugMode",value:function(){return this.debugMode}},{key:"getFillMode",value:function(){return this.fillMode}},{key:"setDrawNodes",value:function(t){var e=!0,i=!1,n=void 0;try{for(var s,o=this.paths[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){s.value.drawNodes=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.drawNodes=t}},{key:"setTraceMode",value:function(t){var e=!0,i=!1,n=void 0;try{for(var s,o=this.paths[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){s.value.traceMode=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.traceMode=t}},{key:"setInvertedColors",value:function(t){var e=!0,i=!1,n=void 0;try{for(var s,o=this.paths[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){s.value.invertedColors=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.invertedColors=t}},{key:"setDebugMode",value:function(t){var e=!0,i=!1,n=void 0;try{for(var s,o=this.paths[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){s.value.debugMode=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.debugMode=t}},{key:"setFillMode",value:function(t){var e=!0,i=!1,n=void 0;try{for(var s,o=this.paths[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){s.value.fillMode=t}}catch(t){i=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.fillMode=t}},{key:"toggleDrawNodes",value:function(){this.setDrawNodes(!this.getDrawNodes())}},{key:"toggleTraceMode",value:function(){this.setTraceMode(!this.getTraceMode())}},{key:"toggleInvertedColors",value:function(){this.setInvertedColors(!this.getInvertedColors())}},{key:"toggleDebugMode",value:function(){this.setDebugMode(!this.getDebugMode())}},{key:"toggleFillMode",value:function(){this.setFillMode(!this.getFillMode())}}]),n}();e.exports=n},{"./Defaults":3}],7:[function(t,e,i){var n,s;n=this,s=function(){function v(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function o(t,e){return t<e?-1:e<t?1:0}return function(t,e,i,n,s){!function t(e,i,n,s,o){for(;n<s;){if(600<s-n){var r=s-n+1,a=i-n+1,h=Math.log(r),l=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*l*(r-l)/r)*(a-r/2<0?-1:1),d=Math.max(n,Math.floor(i-a*l/r+u)),c=Math.min(s,Math.floor(i+(r-a)*l/r+u));t(e,i,d,c,o)}var f=e[i],p=n,y=s;for(v(e,n,i),0<o(e[s],f)&&v(e,n,s);p<y;){for(v(e,p,y),p++,y--;o(e[p],f)<0;)p++;for(;0<o(e[y],f);)y--}0===o(e[n],f)?v(e,n,y):v(e,++y,s),y<=i&&(n=y+1),i<=y&&(s=y-1)}}(t,e,i||0,n||t.length-1,s||o)}},"object"===_typeof(i)&&void 0!==e?e.exports=s():"function"==typeof define&&define.amd?define(s):n.quickselect=s()},{}],8:[function(t,e,i){var m=t("tinyqueue");function n(t,e,i,n,s,o){for(var r,a,h,l,u,d,c,f,p,y=t.data,v=[],x=t.toBBox,g=new m(null,M);y;){for(r=0;r<y.children.length;r++)a=y.children[r],u=e,d=i,c=y.leaf?x(a):a,void 0,f=b(u,c.minX,c.maxX),p=b(d,c.minY,c.maxY),h=f*f+p*p,(!o||h<=o)&&g.push({node:a,isItem:y.leaf,dist:h});for(;g.length&&g.peek().isItem;)if(l=g.pop().node,s&&!s(l)||v.push(l),n&&v.length===n)return v;(y=g.pop())&&(y=y.node)}return v}function M(t,e){return t.dist-e.dist}function b(t,e,i){return t<e?e-t:t<=i?0:t-i}e.exports=n,e.exports.default=n},{tinyqueue:10}],9:[function(t,e,i){e.exports=n,e.exports.default=n;var a=t("quickselect");function n(t,e){if(!(this instanceof n))return new n(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function u(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function f(t,e){x(t,0,t.children.length,e,t)}function x(t,e,i,n,s){s||(s=y(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var o,r=e;r<i;r++)o=t.children[r],d(s,t.leaf?n(o):o);return s}function d(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function o(t,e){return t.minX-e.minX}function r(t,e){return t.minY-e.minY}function g(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function c(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function l(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(t,e,i,n,s){for(var o,r=[e,i];r.length;)(i=r.pop())-(e=r.pop())<=n||(o=e+Math.ceil((i-e)/n/2)*n,a(t,o,e,i,s),r.push(e,o,o,i))}n.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!l(t,e))return i;for(var s,o,r,a,h=[];e;){for(s=0,o=e.children.length;s<o;s++)r=e.children[s],l(t,a=e.leaf?n(r):r)&&(e.leaf?i.push(r):p(t,a)?this._all(r,i):h.push(r));e=h.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!l(t,e))return!1;for(var n,s,o,r,a=[];e;){for(n=0,s=e.children.length;n<s;n++)if(o=e.children[n],l(t,r=e.leaf?i(o):o)){if(e.leaf||p(t,r))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var s=this.data;this.data=n,n=s}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(t,e){if(!t)return this;for(var i,n,s,o,r=this.data,a=this.toBBox(t),h=[],l=[];r||h.length;){if(r||(r=h.pop(),n=h[h.length-1],i=l.pop(),o=!0),r.leaf&&-1!==(s=u(t,r.children,e)))return r.children.splice(s,1),h.push(r),this._condense(h),this;o||r.leaf||!p(r,a)?n?(i++,r=n.children[i],o=!1):r=null:(h.push(r),l.push(i),i=0,r=(n=r).children[0])}return this},toBBox:function(t){return t},compareMinX:o,compareMinY:r,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var s,o=i-e+1,r=this._maxEntries;if(o<=r)return f(s=y(t.slice(e,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(o)/Math.log(r)),r=Math.ceil(o/Math.pow(r,n-1))),(s=y([])).leaf=!1,s.height=n;var a,h,l,u,d=Math.ceil(o/r),c=d*Math.ceil(Math.sqrt(r));for(v(t,e,i,c,this.compareMinX),a=e;a<=i;a+=c)for(v(t,a,l=Math.min(a+c-1,i),d,this.compareMinY),h=a;h<=l;h+=d)u=Math.min(h+d-1,l),s.children.push(this._build(t,h,u,n-1));return f(s,this.toBBox),s},_chooseSubtree:function(t,e,i,n){for(var s,o,r,a,h,l,u,d,c,f;n.push(e),!e.leaf&&n.length-1!==i;){for(u=d=1/0,s=0,o=e.children.length;s<o;s++)h=g(r=e.children[s]),c=t,f=r,(l=(Math.max(f.maxX,c.maxX)-Math.min(f.minX,c.minX))*(Math.max(f.maxY,c.maxY)-Math.min(f.minY,c.minY))-h)<d?(d=l,u=h<u?h:u,a=r):l===d&&h<u&&(u=h,a=r);e=a||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,s=i?t:n(t),o=[],r=this._chooseSubtree(s,this.data,e,o);for(r.children.push(t),d(r,s);0<=e&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(s,o,e)},_split:function(t,e){var i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var o=this._chooseSplitIndex(i,s,n),r=y(i.children.splice(o,i.children.length-o));r.height=i.height,r.leaf=i.leaf,f(i,this.toBBox),f(r,this.toBBox),e?t[e-1].children.push(r):this._splitRoot(i,r)},_splitRoot:function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,s,o,r,a,h,l,u,d,c,f,p,y,v;for(h=l=1/0,n=e;n<=i-e;n++)s=x(t,0,n,this.toBBox),o=x(t,n,i,this.toBBox),d=s,c=o,void 0,f=Math.max(d.minX,c.minX),p=Math.max(d.minY,c.minY),y=Math.min(d.maxX,c.maxX),v=Math.min(d.maxY,c.maxY),r=Math.max(0,y-f)*Math.max(0,v-p),a=g(s)+g(o),r<h?(h=r,u=n,l=a<l?a:l):r===h&&a<l&&(l=a,u=n);return u},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:o,s=t.leaf?this.compareMinY:r;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,s)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var s,o,r=this.toBBox,a=x(t,0,e,r),h=x(t,i-e,i,r),l=c(a)+c(h);for(s=e;s<i-e;s++)o=t.children[s],d(a,t.leaf?r(o):o),l+=c(a);for(s=i-e-1;e<=s;s--)o=t.children[s],d(h,t.leaf?r(o):o),l+=c(h);return l},_adjustParentBBoxes:function(t,e,i){for(var n=i;0<=n;n--)d(e[n],t)},_condense:function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():f(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},{quickselect:7}],10:[function(t,e,i){function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||s,0<this.length)for(var i=(this.length>>1)-1;0<=i;i--)this._down(i)}function s(t,e){return t<e?-1:e<t?1:0}e.exports=n,(e.exports.default=n).prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,n=e[t];0<t;){var s=t-1>>1,o=e[s];if(0<=i(n,o))break;e[t]=o,t=s}e[t]=n},_down:function(t){for(var e=this.data,i=this.compare,n=this.length>>1,s=e[t];t<n;){var o=1+(t<<1),r=o+1,a=e[o];if(r<this.length&&i(e[r],a)<0&&(a=e[o=r]),0<=i(a,s))break;e[t]=a,t=o}e[t]=s}}},{}],11:[function(t,a,e){!function t(e,i,n){var s=function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(!(this instanceof o))return new o(t,e);s(t)?(e=t[1],t=t[0]):"object"===_typeof(t)&&t&&(e=t.y,t=t.x),this.x=o.clean(t||0),this.y=o.clean(e||0)}o.prototype={change:function(t){if("function"==typeof t)this.observers?this.observers.push(t):this.observers=[t];else if(this.observers&&this.observers.length)for(var e=this.observers.length-1;0<=e;e--)this.observers[e](this,t);return this},ignore:function(t){if(this.observers)if(t)for(var e=this.observers,i=e.length;i--;)e[i]===t&&e.splice(i,1);else this.observers=[];return this},set:function(t,e,i){if("number"!=typeof t&&(i=e,e=t.y,t=t.x),this.x===t&&this.y===e)return this;var n=null;return!1!==i&&this.observers&&this.observers.length&&(n=this.clone()),this.x=o.clean(t),this.y=o.clean(e),!1!==i?this.change(n):void 0},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(t){return t?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(t,e,i){return"number"!=typeof t&&(i=e,s(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),t+=this.x,e+=this.y,i?new this.constructor(t,e):this.set(t,e)},subtract:function(t,e,i){return"number"!=typeof t&&(i=e,s(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),t=this.x-t,e=this.y-e,i?new this.constructor(t,e):this.set(t,e)},multiply:function(t,e,i){return"number"!=typeof t?(i=e,s(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)):"number"!=typeof e&&(i=e,e=t),t*=this.x,e*=this.y,i?new this.constructor(t,e):this.set(t,e)},rotate:function(t,e,i){var n,s,o=this.x,r=this.y,a=Math.cos(t),h=Math.sin(t);return n=a*o-(e=e?-1:1)*h*r,s=e*h*o+a*r,i?new this.constructor(n,s):this.set(n,s)},length:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},lengthSquared:function(){var t=this.x,e=this.y;return t*t+e*e},distance:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},nearest:function(t){for(var e,i=Number.MAX_VALUE,n=null,s=t.length-1;0<=s;s--)(e=this.distance(t[s]))<=i&&(i=e,n=t[s]);return n},normalize:function(t){var e=this.length(),i=e<Number.MIN_VALUE?0:1/e;return t?new this.constructor(this.x*i,this.y*i):this.set(this.x*i,this.y*i)},equal:function(t,e){return"number"!=typeof t&&(s(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)),o.clean(t)===this.x&&o.clean(e)===this.y},abs:function(t){var e=Math.abs(this.x),i=Math.abs(this.y);return t?new this.constructor(e,i):this.set(e,i)},min:function(t,e){var i=this.x,n=this.y,s=t.x,o=t.y,r=i<s?i:s,a=n<o?n:o;return e?new this.constructor(r,a):this.set(r,a)},max:function(t,e){var i=this.x,n=this.y,s=t.x,o=t.y,r=s<i?i:s,a=o<n?n:o;return e?new this.constructor(r,a):this.set(r,a)},clamp:function(t,e,i){var n=this.min(e,!0).max(t);return i?n:this.set(n.x,n.y)},lerp:function(t,e,i){return this.add(t.subtract(this,!0).multiply(e),i)},skew:function(t){return t?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(t){return o.clean(this.x*t.x+t.y*this.y)},perpDot:function(t){return o.clean(this.x*t.y-this.y*t.x)},angleTo:function(t){return Math.atan2(this.perpDot(t),this.dot(t))},divide:function(t,e,i){if("number"!=typeof t?(i=e,s(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x)):"number"!=typeof e&&(i=e,e=t),0===t||0===e)throw new Error("division by zero");if(isNaN(t)||isNaN(e))throw new Error("NaN detected");return i?new this.constructor(this.x/t,this.y/e):this.set(this.x/t,this.y/e)},isPointOnLine:function(t,e){return(t.y-this.y)*(t.x-e.x)==(t.y-e.y)*(t.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(t){return this.set(t[0],t[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:o},o.fromArray=function(t,e){return new(e||o)(t[0],t[1])},o.precision=i||8;var r=Math.pow(10,o.precision);return o.clean=e||function(t){if(isNaN(t))throw new Error("NaN detected");if(!isFinite(t))throw new Error("Infinity detected");return Math.round(t)===t?t:Math.round(t*r)/r},o.inject=t,e||(o.fast=t(function(t){return t}),void 0!==a&&"object"==_typeof(a.exports)?a.exports=o:window.Vec2=window.Vec2||o),o}()},{}]},{},[2]);